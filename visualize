import matplotlib.pyplot as plt
import networkx as nx

def visualize_full_graph(G, filename='full_graph.png', node_names=None):
    """Tüm graph'ı görselleştir ve kaydet"""
    plt.figure(figsize=(20, 15))
    
    # Layout seçenekleri (duruma göre değiştirin):
    # pos = nx.spring_layout(G, k=2, iterations=100, seed=42)
    # pos = nx.kamada_kawai_layout(G)
    pos = nx.planar_layout(G) if nx.is_planar(G) else nx.spring_layout(G, k=2, iterations=100, seed=42)
    
    # Node'ları çiz
    nx.draw_networkx_nodes(G, pos, 
                          node_size=500, 
                          node_color='lightblue',
                          edgecolors='black',
                          linewidths=2)
    
    # Edge'leri çiz
    nx.draw_networkx_edges(G, pos, 
                          edge_color='gray', 
                          alpha=0.6, 
                          arrows=True,
                          arrowsize=20,
                          arrowstyle='-|>',
                          connectionstyle='arc3,rad=0.1')
    
    # Node label'ları
    if node_names:
        labels = node_names
    else:
        labels = {node: str(node) for node in G.nodes()}
    
    nx.draw_networkx_labels(G, pos, labels, font_size=10, font_weight='bold')
    
    # Edge weight'leri
    edge_labels = nx.get_edge_attributes(G, 'weight')
    nx.draw_networkx_edge_labels(G, pos, edge_labels, 
                                 font_size=8,
                                 bbox=dict(boxstyle="round,pad=0.3", 
                                          facecolor='yellow', 
                                          alpha=0.7))
    
    plt.title(f"Full Graph - {G.number_of_nodes()} nodes, {G.number_of_edges()} edges", 
              fontsize=16, fontweight='bold')
    plt.axis('off')
    plt.tight_layout()
    plt.savefig(filename, dpi=300, bbox_inches='tight')
    print(f"Full graph saved to {filename}")
    plt.show()

def visualize_full_graph_interactive(G, filename='full_graph.html', node_names=None):
    """İnteraktif görselleştirme - zoom ve pan yapabilirsiniz"""
    from pyvis.network import Network
    
    net = Network(height='900px', width='100%', 
                  bgcolor='#ffffff', 
                  font_color='black',
                  directed=True)
    
    # Fizik ayarları
    net.barnes_hut(gravity=-80000, 
                   central_gravity=0.3,
                   spring_length=200,
                   spring_strength=0.05,
                   damping=0.09)
    
    # Node'ları ekle
    for node in G.nodes():
        label = node_names.get(node, str(node)) if node_names else str(node)
        net.add_node(node, 
                    label=label,
                    title=f"Node {label}\nDegree: {G.degree(node)}",
                    color='lightblue',
                    size=25,
                    font={'size': 14})
    
    # Edge'leri ekle
    for edge in G.edges(data=True):
        u, v = edge[0], edge[1]
        weight = edge[2].get('weight', 1)
        net.add_edge(u, v, 
                    value=weight,
                    title=f"Weight: {weight}",
                    label=str(weight))
    
    # Ayarlar menüsünü göster
    net.show_buttons(filter_=['physics'])
    
    net.save_graph(filename)
    print(f"Interactive graph saved to {filename}")
    return net

def print_graph_info(G):
    """Graph hakkında bilgi yazdır"""
    print("\n" + "="*60)
    print("GRAPH STATISTICS")
    print("="*60)
    print(f"Number of nodes: {G.number_of_nodes()}")
    print(f"Number of edges: {G.number_of_edges()}")
    print(f"Average degree: {sum(dict(G.degree()).values()) / G.number_of_nodes():.2f}")
    print(f"Is directed: {G.is_directed()}")
    print(f"Is connected: {nx.is_weakly_connected(G) if G.is_directed() else nx.is_connected(G)}")
    
    # Derece dağılımı
    degrees = dict(G.degree())
    print(f"\nDegree distribution:")
    print(f"  Min degree: {min(degrees.values())}")
    print(f"  Max degree: {max(degrees.values())}")
    print(f"  Median degree: {sorted(degrees.values())[len(degrees)//2]}")
    
    # En yüksek derece'li node'lar
    top_nodes = sorted(degrees.items(), key=lambda x: x[1], reverse=True)[:5]
    print(f"\nTop 5 nodes by degree:")
    for node, degree in top_nodes:
        print(f"  Node {node}: degree {degree}")
    
    print("="*60 + "\n")



def visualize_paths_only(G, result_paths, node_names=None):
    # Sadece path'lerdeki node'ları içeren subgraph oluştur
    path_nodes = set()
    for path in result_paths:
        path_nodes.update(path.route)
    
    subG = G.subgraph(path_nodes).copy()
    
    plt.figure(figsize=(15, 10))
    pos = nx.spring_layout(subG, k=2, iterations=50)
    
    # Node'ları çiz
    nx.draw_networkx_nodes(subG, pos, node_size=700, node_color='lightblue')
    
    # Her path'i farklı renkle çiz
    colors = ['red', 'blue', 'green', 'orange', 'purple']
    for i, path in enumerate(result_paths):
        edges = [(path.route[j], path.route[j+1]) for j in range(len(path.route)-1)]
        nx.draw_networkx_edges(subG, pos, edgelist=edges, 
                               edge_color=colors[i % len(colors)], 
                               width=3, alpha=0.7, arrows=True,
                               label=f'Path {i+1} (len={path.length})')
    
    labels = node_names if node_names else {node: str(node) for node in subG.nodes()}
    nx.draw_networkx_labels(subG, pos, labels, font_size=12)
    
    edge_labels = nx.get_edge_attributes(subG, 'weight')
    nx.draw_networkx_edge_labels(subG, pos, edge_labels, font_size=8)
    
    plt.legend()
    plt.title("Paths Visualization")
    plt.axis('off')
    plt.tight_layout()
    plt.savefig('paths_only.png', dpi=300, bbox_inches='tight')
    plt.show()

# Kullanım
visualize_paths_only(G, result, node_names)
